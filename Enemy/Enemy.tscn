[gd_scene load_steps=7 format=2]

[ext_resource path="res://Shaders/EnemyLighitng.tres" type="Shader" id=1]
[ext_resource path="res://Enemy/full.png" type="Texture" id=2]

[sub_resource type="GDScript" id=4]
script/source = "extends RigidBody2D


# Declare member variables here. Examples:
# var a = 2
# var b = \"text\"
var blood = preload(\"res://Enemy/Blood.tscn\")

var PlayerPos : Vector2;
var playerInsight = false;



func _ready():
	PlayerPos = self.position;



# Called every frame. 'delta' is the elapsed time since the previous frame.
#func _process(delta):
#	pass
func GetHit():
	for n in 4:
		var instance = blood.instance();
		instance.position = self.position
		instance.rotation = self.rotation;
		get_tree().get_root().get_node(\"Control/ViewportContainer/Viewport/World\").add_child(instance);

	
	
	queue_free()

func _physics_process(delta):
	if (Player.dead):return;
	playerInsight = false;
	
	var space_state = get_world_2d().direct_space_state
	# use global coordinates, not local to node
	var result = space_state.intersect_ray(self.position, Player.position)
	if result and result.collider.name == \"Player\":
		PlayerPos = result.collider.position;
		playerInsight = true;
	
	

	
	#if !(velocity.length() > maxSpeed) :
	#	var target = (PlayerPos - position).normalized();
	#	if(playerInsight):
	#		velocity += target;
	#	else:
	#		velocity += (Vector2(0,0) - velocity).normalized();
			
	#move_and_slide(velocity);
	
	apply_central_impulse((PlayerPos - position).normalized()*10)




func _on_Enemy_body_entered(body):
	if body.name == \"Player\":
		body.TakeDamage(15);
		apply_central_impulse((position-PlayerPos).normalized()*150)
	
"

[sub_resource type="ShaderMaterial" id=1]
shader = ExtResource( 1 )
shader_param/magnitude = 100.34

[sub_resource type="CapsuleMesh" id=5]
radial_segments = 15

[sub_resource type="CircleShape2D" id=3]
radius = 17.0

[node name="Enemy" type="RigidBody2D"]
collision_layer = 2
collision_mask = 15
gravity_scale = 0.0
contacts_reported = 999
contact_monitor = true
linear_damp = 1.0
angular_damp = 1.0
script = SubResource( 4 )

[node name="MeshInstance2D" type="MeshInstance2D" parent="."]
material = SubResource( 1 )
position = Vector2( 0, -0.500001 )
scale = Vector2( 16, 15.5 )
mesh = SubResource( 5 )
texture = ExtResource( 2 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
shape = SubResource( 3 )

[connection signal="body_entered" from="." to="." method="_on_Enemy_body_entered"]
